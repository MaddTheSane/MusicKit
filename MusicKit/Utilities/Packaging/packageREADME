#!/bin/sh
# $Id$
# Create a set of HTML pages suitable for distribution on the
# web-site. We do this with a customised stylesheet (in DSSSL)
# to produce the correct text coloring, background images etc.
#
# Leigh Smith <leigh@tomandandy.com>
#

JADE=jade

# HTML_DISTRIB_DIR makes it easier to install into SourceForge.
HTML_DISTRIB_DIR=htdocs
HTML_TMPDIR=/tmp/$HTML_DISTRIB_DIR
HTML_TARBALL=MusicKitREADME.tar.gz

PDF_TMPDIR=/tmp/mkpdf

# Assume we are standing at the top of the source tree, since with NFS
# it's a bit hard to be universal with paths.
MKSRCDIR=`pwd`
MKREADMESRC=$MKSRCDIR/Documentation/MusicKit_README.sgml
MKCONCEPTS=$MKSRCDIR/Documentation/Frameworks/MusicKit/Concepts/
MK_STYLEDIR=$MKSRCDIR/Documentation/SGML
MK_STYLESHEET=$MK_STYLEDIR/MusicKit_README.dsssl
MKCONCEPTS_STYLESHEET=/usr/lib/sgml/stylesheets/cygnus-both.dsl

#
# Convert all SGML to HTML and package
#
mkdir $HTML_TMPDIR
cd $HTML_TMPDIR
$JADE -t sgml -ihtml -d ${MK_STYLESHEET}\#html $MKREADMESRC
ln -s readme.html index.html
cp $MK_STYLEDIR/Images/*.{gif,jpg,png} .

#
# Generate the Concepts Book underneath the README directory, so it
# can be referenced by URL independent of the README directory.
#
mkdir -p $HTML_TMPDIR/MusicKitConcepts/Images
cd $HTML_TMPDIR/MusicKitConcepts
$JADE -t sgml -ihtml -d ${MKCONCEPTS_STYLESHEET}\#html $MKCONCEPTS/MusicKitConcepts.sgml
cp -r $MKCONCEPTS/Images/*.gif Images
ln -s musickitconcepts.html index.html

#
# Generate The Tutorials
#

#
# Run HeaderDoc over the frameworks
#

#
# Now create a tarball
#
cd ../..
tar czf $HTML_TARBALL $HTML_DISTRIB_DIR
echo MusicKit README HTML pages packaged into /tmp/$HTML_TARBALL
rm -r $HTML_TMPDIR

#
# Now create the PDF of the README
#
mkdir $PDF_TMPDIR
cd $PDF_TMPDIR 
cp $MK_STYLEDIR/Images/*.eps .
db2dvi $MKREADMESRC
FINAL=`basename $MKREADMESRC .sgml`.pdf
dvips -o intermediate.ps MusicKit_README.dvi
# This allows us to incorporate any special postscript fonts.
#psprepare intermediate.ps prepared.ps
cp intermediate.ps prepared.ps
ps2pdf prepared.ps /tmp/$FINAL
echo MusicKit README PDF file generated into /tmp/$FINAL
rm -r $PDF_TMPDIR

# copy all PDFs

